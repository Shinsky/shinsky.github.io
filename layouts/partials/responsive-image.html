{{- $img := .img -}}
{{- $class := .class | default "post-hero" -}}
{{- $alt := .alt | default "" -}}

{{- $type := $img.MediaType.SubType -}}

{{- if eq $type "svg+xml" -}}
{{/* SVGs can't be processed - pass through as-is */}}
<img src="{{ $img.RelPermalink }}" alt="{{ $alt }}" class="{{ $class }}">

{{- else -}}
{{/* Raster images: resize + convert to WebP with srcset */}}
{{- $tiny := $img.Resize "400x webp q80" -}}
{{- $small := $img.Resize "600x webp q80" -}}
{{- $medium := $img.Resize "800x webp q80" -}}
{{- $large := $img.Resize "1200x webp q80" -}}

{{/* Also generate a fallback JPEG for the src attribute */}}
{{- $fallback := $img.Resize "800x q85" -}}

<picture>
    <source
        type="image/webp"
        srcset="{{ $tiny.RelPermalink }} 400w,
                {{ $small.RelPermalink }} 600w,
                {{ $medium.RelPermalink }} 800w,
                {{ $large.RelPermalink }} 1200w"
        sizes="(max-width: 700px) 100vw, 860px">
    <img
        src="{{ $fallback.RelPermalink }}"
        alt="{{ $alt }}"
        class="{{ $class }}"
        width="{{ $fallback.Width }}"
        height="{{ $fallback.Height }}"
        loading="lazy"
        decoding="async">
</picture>
{{- end -}}
